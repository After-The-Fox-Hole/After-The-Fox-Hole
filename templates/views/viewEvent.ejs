<!DOCTYPE html>
<html>
<head>
    <title>View Event</title>
</head>
<body>
<%- include('../partials/header'), ({user})%>

<div>
    <div class="card mx-3 mt-2 border-0" style="">
        <div class="row">
            <div class="col-md-2"></div>
            <div class="col-md-2 border">
                <div class="text-center">

                    <a href="">
                        <h6 class="card-subtitle mb-2 ms-2 text-muted" id="eventCreator"><%=event.owner.name%></h6>
                    </a><% if (edit){ %>
                        <button type="submit" id="edit-button"><a href="/events/edit?id=<%=event._id%>">Edit Event</a></button>
                        <!--                                          insert path for post edit page-->
                    <%} else{%>
                    <%}%>
                </div>
            </div>
            <div class="col-md-5 border">
                <div class="card-body">
                    <div> </div>
                    <a href="">
                        <h5 class="card-title" id="eventTitle"><%=event.title%></h5>
                    </a>

                    <p class="card-text" id="eventContent"><%=event.content%></p>
                    <p class="card-text" id="postCreated"><%=event.timeCreated%></p>
                </div>
            </div>
            <div class="col-md-1 text-center border">
                <a href="">
                    <div>
                        <span class="material-symbols-outlined">add_circle</span>
                        <p>Attending</p>
                    </div>
                </a>
                    <div class="col-md-1 text-center border <% if(vote){%>voted<%}%>">
                        <form action="/vote" method="post">
                            <input class="visually-hidden" name="master" value="<%= event._id %>">
                            <input class="visually-hidden" name="attach" value="">
                            <input class="visually-hidden" name="type" value="event">
                            <input class="visually-hidden scrollField" name="scroll" value="">
                            <button type="submit">VOTE</button>
                            <input class="visually-hidden" name="value" value="<% if (vote){ %>-1<%} else{%>+1<%}%>">
                        </form>
                    </div>

            </div>
            <div class="col-md-2">

            </div>
        </div>
    </div>
    <br>
</div>
<div class="mx-auto my-2 w-50">
    <form action="/comments/add" method="post">
        <div>
            <label for="addCommentText" class="form-label">Comment:</label>
            <textarea class="form-control" id="addCommentText" rows="3" name="content"></textarea>
        </div>
        <div class="d-flex justify-content-end">
            <input class="visually-hidden" name="master" value="<%=event._id%>">
            <input class="visually-hidden" name="type" value="event">
            <input class="visually-hidden" id="scroll" name="scroll" value='0'>
            <button type="submit" class="btn btn-primary my-1" id="addCmtBtn">Add Comment</button>
        </div>
    </form>
    <br>
</div>
<div class="mx-auto my-2 w-50">
    <%-cHtml%>
</div>


<%- include('../partials/footer')%>
<script>
	$(document).ready(function(){
		let jump = "<%=scroll%>"
		let scrollPosition = 0;
		$(".openComment").click(function(){
			let parent = $(this).parent().children("form")
			let openComment= parent.children(".makeComment")
			openComment.each(function (){
				$(this).removeClass("visually-hidden")
			})
		})
		window.scrollTo({
			top: parseInt(jump),
            left: 0,
			behavior: 'instant'
		})

		window.addEventListener('scroll', function () {
			scrollPosition = window.scrollY;
			$(".scrollField").attr("value", scrollPosition)
		});
	})
</script>

</body>
</html>
